## HTTP 协议

### 基本认证

- BASIC 认证（基本认证）

base64 加密

- DIGEST 认证

为什么有 DIGEST 认证？

为弥补 BASIC 认证存在的弱点，从 HTTP/1.1 起就有了 DIGSET 认证。

DIGEST 认证同样适用质询/响应的方式，但不会像 BASIC 认证那样直接发送明文密码。

- 客户端认证

SSL 客户端认证是借由 HTTPS 的客户端证书完成认证的方式。凭借客户端证书认证，服务器可确认访问是否来自已登录的客户端。

- 基于表单的认证

1. 基于表单的认证方法并不是在 HTTP 协议中定义的
2. 使用由 Web 应用程序各自实现基于由表单的认证方式
3. 通过 Cookie 和 Session 的方式来保持用户的状态

### 长连接和短连接

> HTTP 协议是基于请求/响应模式的，因此只要服务端给了相应，本次 HTTP 请求就结束了

> HTTP 的长连接和短连接本质上是 TCP 长连接和短连接

HTTP/1.0 中，默认使用的是短连接。也就是说，浏览器和服务器每进行一次 HTTP 操作，就建立一次连接，结束就中断。
HTTP/1.1 起，默认使用长连接，用以保持连接特性。

### 网关

1. 网关可以作为某种翻译器使用，它抽象出了一种能够到达资源的方法。网关是资源和应用程序之间的粘合剂。

2. 网关扮演的是“协议转换器”的角色。

#### WEB 网关

Web 网关在一侧使用 HTTP 协议，在另一侧使用另一种协议 <客户端协议>/<服务端协议>

1. （HTTP/\*）服务器端网关：通过 HTTP 协议与客户端对话，通过其他协议与服务器通信。

（HTTP/\*）服务器端 Web 网关
（HTTP/HTTPS）服务器端安全网关
（HTTPS/HTTP）客户端安全加速器网关
资源网关

2. （\*/HTTP）客户端网关： 通过其他协议与客户端对话，通过 HTTP 协议与服务器通信。

### 缓存

- Cache-Control

请求/响应头，缓存控制字段

no-store: 所有内容都不缓存
no-cache: 缓存，但是浏览器使用缓存前，都会请求服务器判断缓存资源是否是最新
max-age=x(单位秒)请求缓存后的 X 秒不再发起请求。
s-maxage=x(单位秒)代理服务器请求源站缓存后的 X 秒不再发起请求，只对 CDN 缓存有效。
public 客户端和代理服务器（CDN）都可以缓存
private 只有客户端可以缓存

- Expires

响应头，代表资源过期时间，由服务器返回提供，是 http1.0 的属性，在与 max-age 共存的情况下，优先级要低。

- Last-Modified

响应头，资源最新修改时间，由服务器告诉浏览器

- if-Modified-Since

请求头，资源最新修改时间，由浏览器告诉服务器，和 Last-Modified 是一对，它两会进行对比

- Etag

响应头，资源标识，由服务器告诉浏览器

- if-Nono-Match

请求头，缓存资源标识，由浏览器告诉服务器（其实就是上次服务器给的 Etag）,和 Etag 是一对，它两会进行对比

#### 缓存改进方案

- md5/hash 缓存

通过不缓存 html，为静态文件添加 MD5 或者 hash 标识，解决浏览器无法跳过缓存过期时间主动感知文件变化的问题。

- CDN 缓存

### 内容协商机制

只客户端和服务器端就相应的资源内容进行交涉，然后提供给客户端最为适合的资源。内容协商会以相应资源的语言，字符集，编码方式等作为判断的基准。

- 客户端驱动

客户端发起请求，服务器发送可选项列表，客户端作出选择后再发送第二次请求

- 服务器驱动

服务器检查客户端的请求头部集并决定提供哪个版本的页面

- 透明协商

某个中间设备（通常是缓存代理）代表客户端进行缓存

#### 服务器驱动内容协商 — 请求首部集

- Accept: 告知服务器发送何种媒体类型 - Content-Type

- Accept-Language: 告知服务器发送何种语言 - Content-Language

- Accept-Charset: 告知服务器发送何种字符集 - Content-Type

- Accept-Encoding: 告知服务器采用何种编码 - Content-Encoding

#### 服务器驱动内容协商——近似匹配

Accept-Language:en;q=0.5,fr;q=0.0,nl;q=1.0,tr;q=0.0

### 断点续传和多线程下载

HTTP 是通过在 Header 里两个参数实现的，客户端发请求时对应的是 Range,服务器端响应时对应的是 Content-Range

- Range

用于请求头中，指定第一个字节的位置和最后一个字节的位置，一般格式如下：

`Range:(unit-first byte pos)-[last byte pos]`

- Content-Range

用于响应头中，在发出带 Range 的请求后，服务器会在 Content-Range 头部返回当前接收的范围和文件总大小。一般格式：

`Content-Range: bytes(unit first byte pos) - [last byte pos]/[entity legth]`

而在相应完成后，返回的响应头内容也不同：

`HTTP/1.1 200 Ok(不适用断点续传方式)`

`HTTP/1.1 206 Partial Content(使用断点续传方式)`
